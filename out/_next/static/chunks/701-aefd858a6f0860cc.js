"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[701],{4320:function(e,t,i){i.d(t,{AuthProvider:function(){return s},a:function(){return l}});var r=i(7437),n=i(2265),a=i(2141);let o=(0,n.createContext)({user:null,profile:null,session:null,loading:!0,signIn:()=>{},signOut:async()=>{},signInWithGoogle:async()=>{},refreshProfile:async()=>{}}),l=()=>(0,n.useContext)(o);function s(e){let{children:t}=e,[i,l]=(0,n.useState)(null),[s,u]=(0,n.useState)(null),[c,d]=(0,n.useState)(null),[f,_]=(0,n.useState)(!0),h=e=>{var t,i,r,n,a;return{id:e.id,email:e.email||"",name:(null===(t=e.user_metadata)||void 0===t?void 0:t.full_name)||(null===(i=e.user_metadata)||void 0===i?void 0:i.name)||(null===(r=e.email)||void 0===r?void 0:r.split("@")[0])||"Kullanıcı",avatar:(null===(n=e.user_metadata)||void 0===n?void 0:n.avatar_url)||(null===(a=e.user_metadata)||void 0===a?void 0:a.picture)}},v=(0,n.useCallback)(async(e,t)=>{try{let{data:i,error:r}=await a.O.from("customer_profiles").select("*").eq("user_id",e).single();if(i)return i;if((null==r?void 0:r.code)==="PGRST116"){let i={user_id:e,display_name:t,anonymous_id:function(){let e="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",t="ORD-";for(let i=0;i<6;i++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}()},{data:r,error:n}=await a.O.from("customer_profiles").insert(i).select().single();if(n)return console.error("Profile create error:",n),null;return r}return null}catch(e){return console.error("Profile load error:",e),null}},[]);(0,n.useEffect)(()=>{let e=!0;(async()=>{try{let{data:{session:t}}=await a.O.auth.getSession();if(e&&(null==t?void 0:t.user)){let i=h(t.user);d(t),l(i);let r=await v(t.user.id,i.name);e&&u(r)}}catch(e){console.error("Auth init error:",e)}finally{e&&_(!1)}})();let{data:{subscription:t}}=a.O.auth.onAuthStateChange(async(t,i)=>{if(console.log("Auth state changed:",t),e){if("SIGNED_IN"===t&&(null==i?void 0:i.user)){let t=h(i.user);d(i),l(t);let r=await v(i.user.id,t.name);e&&u(r)}else"SIGNED_OUT"===t?(d(null),l(null),u(null)):"TOKEN_REFRESHED"===t&&i&&d(i);e&&_(!1)}});return()=>{e=!1,t.unsubscribe()}},[v]);let m=async()=>{let{error:e}=await a.O.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(e)throw console.error("Google sign in error:",e),e},y=async()=>{let{error:e}=await a.O.auth.signOut();e&&console.error("Sign out error:",e)},p=async()=>{i&&u(await v(i.id,i.name))};return(0,r.jsx)(o.Provider,{value:{user:i,profile:s,session:c,loading:f,signIn:e=>{l(e),u({id:"demo-profile",user_id:e.id,display_name:e.name,anonymous_id:"DEMO-"+Math.random().toString(36).substr(2,6).toUpperCase(),created_at:new Date().toISOString()})},signOut:y,signInWithGoogle:m,refreshProfile:p},children:t})}},3055:function(e,t,i){i.d(t,{LocationProvider:function(){return l},T:function(){return s}});var r=i(7437),n=i(2265);let a=(0,n.createContext)(void 0),o={latitude:41.0082,longitude:28.9784,district:"İstanbul",neighborhood:"Merkez"};function l(e){let{children:t}=e,[i,l]=(0,n.useState)("not_set"),[s,u]=(0,n.useState)(null),[c,d]=(0,n.useState)(!1),[f,_]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=localStorage.getItem("location_permission");e&&(l(e),"always"===e||"while_using"===e?h():"never"===e&&u(o))},[]);let h=async()=>{if(!navigator.geolocation){_("Tarayıcınız konum \xf6zelliğini desteklemiyor"),u(o);return}d(!0),_(null);try{let{latitude:a,longitude:o}=(await new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(e,t,{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})})).coords;try{var e,t,i,r,n;let l=await fetch("https://nominatim.openstreetmap.org/reverse?lat=".concat(a,"&lon=").concat(o,"&format=json&accept-language=tr")),s=await l.json();u({latitude:a,longitude:o,district:(null===(e=s.address)||void 0===e?void 0:e.suburb)||(null===(t=s.address)||void 0===t?void 0:t.district)||(null===(i=s.address)||void 0===i?void 0:i.city_district)||"Bilinmiyor",neighborhood:(null===(r=s.address)||void 0===r?void 0:r.neighbourhood)||(null===(n=s.address)||void 0===n?void 0:n.quarter)||""})}catch(e){u({latitude:a,longitude:o})}}catch(e){1===e.code?(_("Konum izni reddedildi"),l("never"),localStorage.setItem("location_permission","never")):_("Konum alınamadı"),u(o)}finally{d(!1)}};return(0,r.jsx)(a.Provider,{value:{permission:i,location:s,loading:c,error:f,setPermission:e=>{l(e),localStorage.setItem("location_permission",e),"never"===e?u(o):("always"===e||"while_using"===e)&&h()},requestLocation:h,clearLocation:()=>{u(null),l("not_set"),localStorage.removeItem("location_permission")}},children:t})}function s(){let e=(0,n.useContext)(a);if(void 0===e)throw Error("useLocation must be used within a LocationProvider");return e}},2141:function(e,t,i){i.d(t,{O:function(){return r}});let r=(0,i(9066).eI)("https://ipobkbhcrkrqgbohdeea.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlwb2JrYmhjcmtycWdib2hkZWVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0MzE1MjgsImV4cCI6MjA4MDAwNzUyOH0.QaUkRsv_B3Msc9qYmE366k1x_sTe8j5GxLUO3oKKg3w",{auth:{detectSessionInUrl:!0,persistSession:!0,autoRefreshToken:!0}})},3001:function(e,t,i){i.d(t,{o:function(){return l}});var r=i(2265),n=i(2141),a=i(4320),o=i(3055);function l(){let{user:e}=(0,a.a)(),{location:t}=(0,o.T)(),[i,l]=(0,r.useState)([]),[s,u]=(0,r.useState)([]),[c,d]=(0,r.useState)(null),[f,_]=(0,r.useState)({is_discoverable:!1,show_in_venue:!0,show_nearby:!1}),[h,v]=(0,r.useState)(!1);(0,r.useEffect)(()=>{e&&m()},[e]),(0,r.useEffect)(()=>{e&&t&&f.is_discoverable&&p()},[t,f.is_discoverable]),(0,r.useEffect)(()=>{if(!e||!f.is_discoverable)return;let i=setInterval(()=>{t&&p()},3e4);return()=>clearInterval(i)},[e,t,f.is_discoverable]);let m=async()=>{if(!e)return;let{data:t}=await n.O.from("customer_profiles").select("is_discoverable, show_in_venue, show_nearby").eq("user_id",e.id).single();if(t){var i,r,a;_({is_discoverable:null!==(i=t.is_discoverable)&&void 0!==i&&i,show_in_venue:null===(r=t.show_in_venue)||void 0===r||r,show_nearby:null!==(a=t.show_nearby)&&void 0!==a&&a})}},y=async t=>{e&&(_({...f,...t}),await n.O.from("customer_profiles").update(t).eq("user_id",e.id),!1===t.is_discoverable&&await n.O.from("user_presence").delete().eq("user_id",e.id))},p=async()=>{if(!e||!t)return;let{error:i}=await n.O.from("user_presence").upsert({user_id:e.id,latitude:t.latitude,longitude:t.longitude,venue_id:c,is_visible:f.is_discoverable,status:"available",last_seen:new Date().toISOString()},{onConflict:"user_id"});i&&console.error("Presence update error:",i)},g=async function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"manual";if(!e)return!1;await n.O.from("venue_checkins").update({is_active:!1,checked_out_at:new Date().toISOString()}).eq("user_id",e.id).eq("is_active",!0);let{error:r}=await n.O.from("venue_checkins").insert({user_id:e.id,venue_id:t,source:i,is_active:!0});return!r&&(d(t),f.is_discoverable&&await p(),!0)};return{nearbyUsers:i,venueUsers:s,currentVenueId:c,settings:f,loading:h,updateSettings:y,fetchNearbyUsers:async function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(!t)return;v(!0);let{data:r,error:a}=await n.O.rpc("get_nearby_users",{p_lat:t.latitude,p_lon:t.longitude,p_radius_km:i});if(r&&!a){let t=r.map(e=>e.user_id).filter(t=>t!==(null==e?void 0:e.id));if(t.length>0){let{data:i}=await n.O.from("customer_profiles").select("user_id, display_name, avatar_url, bio").in("user_id",t),a={};null==i||i.forEach(e=>{a[e.user_id]=e}),l(r.filter(t=>t.user_id!==(null==e?void 0:e.id)).map(e=>({...e,profile:a[e.user_id]})))}else l([])}v(!1)},fetchVenueUsers:async t=>{v(!0);let{data:i,error:r}=await n.O.from("venue_checkins").select("*").eq("venue_id",t).eq("is_active",!0).neq("user_id",(null==e?void 0:e.id)||"");if(i&&!r){let e=i.map(e=>e.user_id);if(e.length>0){let{data:t}=await n.O.from("customer_profiles").select("user_id, display_name, avatar_url, bio").in("user_id",e),r={};null==t||t.forEach(e=>{r[e.user_id]=e}),u(i.map(e=>({...e,profile:r[e.user_id]})))}else u([])}v(!1)},checkInToVenue:g,checkOut:async()=>{e&&(await n.O.from("venue_checkins").update({is_active:!1,checked_out_at:new Date().toISOString()}).eq("user_id",e.id).eq("is_active",!0),d(null),u([]))},getCurrentCheckin:async()=>{if(!e)return null;let{data:t}=await n.O.from("venue_checkins").select("*, venue:venues(name)").eq("user_id",e.id).eq("is_active",!0).single();return t&&d(t.venue_id),t},updatePresence:p}}},9763:function(e,t,i){i.d(t,{Z:function(){return o}});var r=i(2265),n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),o=(e,t)=>{let i=(0,r.forwardRef)((i,o)=>{let{color:l="currentColor",size:s=24,strokeWidth:u=2,absoluteStrokeWidth:c,className:d="",children:f,..._}=i;return(0,r.createElement)("svg",{ref:o,...n,width:s,height:s,stroke:l,strokeWidth:c?24*Number(u)/Number(s):u,className:["lucide","lucide-".concat(a(e)),d].join(" "),..._},[...t.map(e=>{let[t,i]=e;return(0,r.createElement)(t,i)}),...Array.isArray(f)?f:[f]])});return i.displayName="".concat(e),i}},2660:function(e,t,i){i.d(t,{Z:function(){return r}});let r=(0,i(9763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},1197:function(e,t,i){i.d(t,{Z:function(){return r}});let r=(0,i(9763).Z)("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]])},7769:function(e,t,i){i.d(t,{Z:function(){return r}});let r=(0,i(9763).Z)("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]])},2208:function(e,t,i){i.d(t,{Z:function(){return r}});let r=(0,i(9763).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},3774:function(e,t,i){i.d(t,{Z:function(){return r}});let r=(0,i(9763).Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},5287:function(e,t,i){i.d(t,{Z:function(){return r}});let r=(0,i(9763).Z)("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]])}}]);