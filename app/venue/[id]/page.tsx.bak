'use client'

import { useState, useEffect } from 'react'
import { useParams, useRouter, useSearchParams } from 'next/navigation'
import { 
  ChevronLeft, ChevronDown, ChevronRight, Heart, MapPin, Clock, Phone, Star, 
  ShoppingCart, Minus, Plus, Lock, X, Send, Navigation, Calendar, 
  PawPrint, Music, Wifi, CreditCard, Car, Baby, Accessibility, Cigarette,
  Instagram, Globe, Share2
} from 'lucide-react'
import { supabase } from '`/lib/supabase'
import ShareModal from '`/components/ShareModal'
import { useAuth } from '`/lib/AuthContext'

interface MenuItem {
  id: string
  name: string
  description?: string
  price: number
  category_id: string
}

interface MenuCategory {
  id: string
  name: string
  items: MenuItem[]
}

interface Venue {
  id: string
  name: string
  slug: string
  description?: string
  address?: string
  district?: string
  city?: string
  phone?: string
  email?: string
  website?: string
  instagram?: string
  rating?: number
  review_count?: number
  latitude?: number
  longitude?: number
  features?: string[]
  working_hours?: any
  images?: string[]
}

interface CartItem {
  id: string
  name: string
  price: number
  quantity: number
}

// Özellik ikonları
const featureIcons: Record<string, { icon: any; label: string }> = {
  'pet_friendly': { icon: PawPrint, label: 'Pet Dostu' },
  'live_music': { icon: Music, label: 'Canlı Müzik' },
  'wifi': { icon: Wifi, label: 'Ücretsiz WiFi' },
  'card_payment': { icon: CreditCard, label: 'Kredi Kartı' },
  'parking': { icon: Car, label: 'Otopark' },
  'kid_friendly': { icon: Baby, label: 'Çocuk Dostu' },
  'wheelchair': { icon: Accessibility, label: 'Engelli Erişimi' },
  'smoking_area': { icon: Cigarette, label: 'Sigara Alanı' },
}

export default function VenueDetailPage() {
  const params = useParams()
  const router = useRouter()
  const searchParams = useSearchParams()
  
  const tableFromUrl = searchParams.get('table')
  const canOrder = !!tableFromUrl
  
  const [venue, setVenue] = useState<Venue | null>(null)
  const [categories, setCategories] = useState<MenuCategory[]>([])
  const [expandedCategory, setExpandedCategory] = useState<string | null>(null)
  const [loading, setLoading] = useState(true)
  const [isFavorite, setIsFavorite] = useState(false)
  const [activeTab, setActiveTab] = useState<'about' | 'menu' | 'reviews'>('about')
  const [showReservationModal, setShowReservationModal] = useState(false)
  
  // Sepet
  const [cart, setCart] = useState<CartItem[]>([])
  const [showCart, setShowCart] = useState(false)
  const [showShareModal, setShowShareModal] = useState(false)
  const [customerName, setCustomerName] = useState('')
  const [note, setNote] = useState('')
  const [ordering, setOrdering] = useState(false)
  const [orderSuccess, setOrderSuccess] = useState(false)
  const [orderId, setOrderId] = useState('')

  useEffect(() => {
    if (params.id) {
      loadVenue(params.id as string)
    }
  }, [params.id])

  const loadVenue = async (id: string) => {
    try {
    const cleanId = id.replace('order-', '')
    
    let { data: venueData } = await supabase
      .from('venues')
      .select('*')
      .eq('slug', cleanId)
      .single()

    if (!venueData) {
      const { data } = await supabase
        .from('venues')
        .select('*')
        .eq('id', cleanId)
        .single()
      venueData = data
    }

    if (!venueData) {
      setLoading(false)
      return
    }

    setVenue(venueData)

    // Kategoriler ve menü
    const { data: categoriesData } = await supabase
      .from('menu_categories')
      .select('*')
      .eq('venue_id', venueData.id)
      .eq('is_active', true)
      .order('display_order')

    const { data: itemsData } = await supabase
      .from('menu_items')
      .select('*')
      .eq('venue_id', venueData.id)
      .eq('is_available', true)

    const cats: MenuCategory[] = (categoriesData || [])
      .map(cat => ({
        ...cat,
        items: (itemsData || []).filter(item => item.category_id === cat.id)
      }))
      .filter(cat => cat.items.length > 0)

    setCategories(cats)
    setLoading(false)
  } catch (error) {
    console.error("Venue load error:", error)
    setLoading(false)
  }

  const openMaps = () => {
    if (!venue) return
    const address = encodeURIComponent(`${venue.name}, ${venue.address}, ${venue.district}, ${venue.city}`)
    // iOS için Apple Maps, diğerleri için Google Maps
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent)
    const url = isIOS 
      ? `maps://maps.apple.com/?q=${address}`
      : `https://www.google.com/maps/search/?api=1&query=${address}`
    window.open(url, '_blank')
  }

  const toggleCategory = (categoryId: string) => {
    setExpandedCategory(prev => prev === categoryId ? null : categoryId)
  }

  const addToCart = (item: MenuItem) => {
    if (!canOrder) return
    setCart(prev => {
      const existing = prev.find(i => i.id === item.id)
      if (existing) {
        return prev.map(i => i.id === item.id ? { ...i, quantity: i.quantity + 1 } : i)
      }
      return [...prev, { id: item.id, name: item.name, price: item.price, quantity: 1 }]
    })
  }

  const removeFromCart = (itemId: string) => {
    setCart(prev => {
      const existing = prev.find(i => i.id === itemId)
      if (existing && existing.quantity > 1) {
        return prev.map(i => i.id === itemId ? { ...i, quantity: i.quantity - 1 } : i)
      }
      return prev.filter(i => i.id !== itemId)
    })
  }

  const getItemQuantity = (itemId: string) => cart.find(i => i.id === itemId)?.quantity || 0
  const cartTotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0)
  const cartCount = cart.reduce((sum, item) => sum + item.quantity, 0)

  const handlePlaceOrder = async () => {
    if (!venue || cart.length === 0 || !tableFromUrl) return

    setOrdering(true)
    const orderNumber = `ORD-${Date.now().toString().slice(-6)}`
    const tax = Math.round(cartTotal * 0.08)

    const { data: order, error } = await supabase
      .from('orders')
      .insert({
        venue_id: venue.id,
        order_number: orderNumber,
        table_number: tableFromUrl,
        type: 'dine_in',
        status: 'pending',
        payment_status: 'pending',
        subtotal: cartTotal,
        tax: tax,
        total: cartTotal + tax,
        customer_name: customerName || 'Misafir',
        notes: note || null,
        items: cart.map(item => ({
          id: item.id,
          name: item.name,
          price: item.price,
          quantity: item.quantity,
          status: 'pending'
        }))
      })
      .select()
      .single()

    if (error) {
      alert('Sipariş oluşturulamadı: ' + error.message)
      setOrdering(false)
      return
    }

    await supabase
      .from('tables')
      .update({ status: 'occupied' })
      .eq('venue_id', venue.id)
      .eq('table_number', tableFromUrl)

    setOrderId(order.id)
    setOrderSuccess(true)
    setCart([])
    setShowCart(false)
    setOrdering(false)
  }

  if (loading) {
    return (
      <div className="min-h-screen bg-[#0a0a0a] flex items-center justify-center">
        <div className="w-8 h-8 border-2 border-orange-500 border-t-transparent rounded-full animate-spin" />
      </div>
    )
  }

  if (!venue) {
    return (
      <div className="min-h-screen bg-[#0a0a0a] text-white flex items-center justify-center">
        <p>Mekan bulunamadı</p>
      </div>
    )
  }

  if (orderSuccess) {
    return (
      <div className="min-h-screen bg-[#0a0a0a] text-white flex flex-col items-center justify-center p-6">
        <div className="w-20 h-20 rounded-full bg-green-500/20 flex items-center justify-center mb-6">
          <Send className="w-10 h-10 text-green-500" />
        </div>
        <h1 className="text-2xl font-bold mb-2">Siparişiniz Alındı!</h1>
        <p className="text-gray-400 mb-1">{venue.name}</p>
        <p className="text-gray-400 mb-6">Masa {tableFromUrl}</p>
        <p className="text-orange-500 font-mono mb-8">#{orderId.slice(0, 8)}</p>
        <div className="w-full max-w-sm space-y-3">
          <button onClick={() => setOrderSuccess(false)} className="w-full py-4 bg-orange-500 rounded-xl font-semibold">
            Yeni Sipariş Ver
          </button>
          <button onClick={() => router.push('/orders')} className="w-full py-4 bg-[#1a1a1a] border border-white/10 rounded-xl">
            Siparişlerimi Gör
          </button>
        </div>
      </div>
    )
  }

  // Demo özellikler (gerçek veride features array'den gelecek)
  const venueFeatures = venue.features || ['pet_friendly', 'wifi', 'card_payment', 'parking']

  return (
    <div className="min-h-screen bg-[#0a0a0a] text-white pb-32">
      {/* Header Image */}
      <div className="relative h-64 bg-gradient-to-br from-orange-600 to-red-600">
        <div className="absolute inset-0 bg-black/20" />
        <div className="absolute top-4 left-4 right-4 flex justify-between z-10">
          <button onClick={() => router.back()} className="w-10 h-10 rounded-full bg-black/30 backdrop-blur flex items-center justify-center">
            <ChevronLeft className="w-5 h-5" />
          </button>
          <div className="flex gap-2">
            <button className="w-10 h-10 rounded-full bg-black/30 backdrop-blur flex items-center justify-center">
              <Share2 className="w-5 h-5" onClick={() => setShowShareModal(true)} />
            </button>
            <button onClick={() => setIsFavorite(!isFavorite)} className="w-10 h-10 rounded-full bg-black/30 backdrop-blur flex items-center justify-center">
              <Heart className={`w-5 h-5 ${isFavorite ? 'fill-red-500 text-red-500' : ''}`} />
            </button>
          </div>
        </div>
      </div>

      {/* Venue Info Card */}
      <div className="mx-4 -mt-16 relative z-10 bg-[#1a1a1a] rounded-2xl p-4 border border-white/10">
        <h1 className="text-2xl font-bold mb-2">{venue.name}</h1>
        
        {/* Rating & Category */}
        <div className="flex items-center gap-3 mb-3">
          {venue.rating && (
            <div className="flex items-center gap-1 bg-yellow-500/20 text-yellow-500 px-2 py-1 rounded-lg text-sm">
              <Star className="w-4 h-4 fill-yellow-500" />
              <span className="font-semibold">{venue.rating}</span>
              <span className="text-yellow-500/70">({venue.review_count || 0})</span>
            </div>
          )}
          <span className="text-gray-400 text-sm">Restoran</span>
        </div>

        {/* Address with Maps Link */}
        {venue.address && (
          <button onClick={openMaps} className="flex items-start gap-3 mb-3 text-left w-full group">
            <MapPin className="w-5 h-5 text-orange-500 flex-shrink-0 mt-0.5" />
            <div className="flex-1">
              <p className="text-sm text-gray-300 group-hover:text-orange-500 transition-colors">
                {venue.address}
              </p>
              <p className="text-sm text-gray-500">{venue.district}, {venue.city}</p>
            </div>
            <Navigation className="w-5 h-5 text-orange-500" />
          </button>
        )}

        {/* Working Hours */}
        <div className="flex items-center gap-3 mb-3 text-sm">
          <Clock className="w-5 h-5 text-green-500" />
          <span className="text-green-500">Açık</span>
          <span className="text-gray-400">• 10:00 - 00:00</span>
        </div>

        {/* Contact Buttons */}
        <div className="flex gap-2 mb-4">
          {venue.phone && (
            <a href={`tel:${venue.phone}`} className="flex-1 flex items-center justify-center gap-2 py-3 bg-[#242424] rounded-xl text-sm">
              <Phone className="w-4 h-4 text-orange-500" />
              <span>Ara</span>
            </a>
          )}
          {venue.instagram && (
            <a href={`https://instagram.com/${venue.instagram.replace('`', '')}`} target="_blank" className="flex-1 flex items-center justify-center gap-2 py-3 bg-[#242424] rounded-xl text-sm">
              <Instagram className="w-4 h-4 text-pink-500" />
              <span>Instagram</span>
            </a>
          )}
          {venue.website && (
            <a href={venue.website} target="_blank" className="flex-1 flex items-center justify-center gap-2 py-3 bg-[#242424] rounded-xl text-sm">
              <Globe className="w-4 h-4 text-blue-500" />
              <span>Website</span>
            </a>
          )}
        </div>

        {/* Features */}
        <div className="flex flex-wrap gap-2">
          {venueFeatures.map(feature => {
            const featureInfo = featureIcons[feature]
            if (!featureInfo) return null
            const Icon = featureInfo.icon
            return (
              <div key={feature} className="flex items-center gap-1.5 px-3 py-1.5 bg-[#242424] rounded-full text-xs">
                <Icon className="w-3.5 h-3.5 text-orange-500" />
                <span className="text-gray-300">{featureInfo.label}</span>
              </div>
            )
          })}
        </div>
      </div>

      {/* Action Buttons */}
      <div className="px-4 mt-4 grid grid-cols-2 gap-3">
        <button
          onClick={() => setShowReservationModal(true)}
          className="flex items-center justify-center gap-2 py-4 bg-orange-500 rounded-xl font-semibold"
        >
          <Calendar className="w-5 h-5" />
          Rezervasyon Yap
        </button>
        <button
          onClick={openMaps}
          className="flex items-center justify-center gap-2 py-4 bg-[#1a1a1a] border border-white/10 rounded-xl font-semibold"
        >
          <Navigation className="w-5 h-5" />
          Yol Tarifi Al
        </button>
      </div>

      {/* QR Bilgilendirme */}
      {canOrder && (
        <div className="mx-4 mt-4 p-4 bg-green-500/10 border border-green-500/30 rounded-xl flex items-center gap-3">
          <ShoppingCart className="w-5 h-5 text-green-500" />
          <div>
            <p className="text-green-500 font-medium text-sm">Masa {tableFromUrl} - Sipariş Verebilirsiniz</p>
            <p className="text-green-500/70 text-xs">Menüden ürün seçerek sipariş verebilirsiniz</p>
          </div>
        </div>
      )}

      {/* Tabs */}
      <div className="flex border-b border-white/5 mt-4">
        <button
          onClick={() => setActiveTab('about')}
          className={`flex-1 py-4 text-center font-medium text-sm ${activeTab === 'about' ? 'text-orange-500 border-b-2 border-orange-500' : 'text-gray-400'}`}
        >
          Hakkında
        </button>
        <button
          onClick={() => setActiveTab('menu')}
          className={`flex-1 py-4 text-center font-medium text-sm ${activeTab === 'menu' ? 'text-orange-500 border-b-2 border-orange-500' : 'text-gray-400'}`}
        >
          Menü
        </button>
        <button
          onClick={() => setActiveTab('reviews')}
          className={`flex-1 py-4 text-center font-medium text-sm ${activeTab === 'reviews' ? 'text-orange-500 border-b-2 border-orange-500' : 'text-gray-400'}`}
        >
          Yorumlar
        </button>
      </div>

      {/* Tab Content */}
      {activeTab === 'about' && (
        <div className="p-4">
          {venue.description ? (
            <p className="text-gray-300 leading-relaxed">{venue.description}</p>
          ) : (
            <p className="text-gray-500">Mekan hakkında bilgi bulunmuyor.</p>
          )}
          
          {/* Çalışma Saatleri */}
          <div className="mt-6">
            <h3 className="font-semibold mb-3">Çalışma Saatleri</h3>
            <div className="space-y-2 text-sm">
              {['Pazartesi', 'Salı', 'Çarşamba', 'Perşembe', 'Cuma', 'Cumartesi', 'Pazar'].map(day => (
                <div key={day} className="flex justify-between">
                  <span className="text-gray-400">{day}</span>
                  <span>10:00 - 00:00</span>
                </div>
              ))}
            </div>
          </div>
        </div>
      )}

      {activeTab === 'menu' && (
        <div className="p-4">
          {categories.length === 0 ? (
            <p className="text-center text-gray-500 py-8">Menü bulunamadı</p>
          ) : (
            <div className="space-y-2">
              {categories.map(category => (
                <div key={category.id} className="bg-[#1a1a1a] rounded-xl overflow-hidden border border-white/5">
                  <button
                    onClick={() => toggleCategory(category.id)}
                    className="w-full px-4 py-4 flex items-center justify-between"
                  >
                    <div className="flex items-center gap-3">
                      <span className="font-semibold">{category.name}</span>
                      <span className="text-xs text-gray-500 bg-white/5 px-2 py-0.5 rounded-full">
                        {category.items.length}
                      </span>
                    </div>
                    {expandedCategory === category.id ? (
                      <ChevronDown className="w-5 h-5 text-gray-400" />
                    ) : (
                      <ChevronRight className="w-5 h-5 text-gray-400" />
                    )}
                  </button>

                  {expandedCategory === category.id && (
                    <div className="border-t border-white/5">
                      {category.items.map(item => {
                        const qty = getItemQuantity(item.id)
                        return (
                          <div key={item.id} className="px-4 py-3 border-b border-white/5 last:border-0 flex items-center justify-between">
                            <div className="flex-1 pr-4">
                              <h4 className="font-medium">{item.name}</h4>
                              {item.description && (
                                <p className="text-gray-400 text-sm line-clamp-1">{item.description}</p>
                              )}
                              <p className="text-orange-500 font-semibold mt-1">₺{item.price}</p>
                            </div>
                            
                            {canOrder ? (
                              qty > 0 ? (
                                <div className="flex items-center gap-2">
                                  <button onClick={() => removeFromCart(item.id)} className="w-8 h-8 rounded-full bg-[#242424] flex items-center justify-center">
                                    <Minus className="w-4 h-4" />
                                  </button>
                                  <span className="w-6 text-center font-semibold">{qty}</span>
                                  <button onClick={() => addToCart(item)} className="w-8 h-8 rounded-full bg-orange-500 flex items-center justify-center">
                                    <Plus className="w-4 h-4" />
                                  </button>
                                </div>
                              ) : (
                                <button onClick={() => addToCart(item)} className="px-4 py-2 bg-orange-500 rounded-lg text-sm font-medium">
                                  + Ekle
                                </button>
                              )
                            ) : null}
                          </div>
                        )
                      })}
                    </div>
                  )}
                </div>
              ))}
            </div>
          )}
        </div>
      )}

      {activeTab === 'reviews' && (
        <div className="p-4">
          <p className="text-center text-gray-500 py-8">Henüz yorum yok</p>
        </div>
      )}

      {/* Sepet Butonu */}
      {canOrder && cartCount > 0 && !showCart && (
        <div className="fixed bottom-20 left-4 right-4 z-50">
          <button
            onClick={() => setShowCart(true)}
            className="w-full py-4 bg-orange-500 rounded-xl font-semibold flex items-center justify-center gap-3 shadow-lg shadow-orange-500/30"
          >
            <ShoppingCart className="w-5 h-5" />
            Sepeti Gör ({cartCount}) - ₺{cartTotal}
          </button>
        </div>
      )}

      {/* Sepet Modal */}
      {showCart && (
        <div className="fixed inset-0 z-50 bg-black/80 flex items-end">
          <div className="w-full max-h-[80vh] bg-[#1a1a1a] rounded-t-3xl flex flex-col">
            <div className="flex items-center justify-between p-4 border-b border-white/5">
              <h2 className="text-xl font-bold">Sepetim</h2>
              <button onClick={() => setShowCart(false)} className="w-8 h-8 rounded-full bg-[#242424] flex items-center justify-center">
                <X className="w-5 h-5" />
              </button>
            </div>
            
            <div className="flex-1 overflow-auto p-4 space-y-3">
              {cart.map(item => (
                <div key={item.id} className="flex items-center justify-between bg-[#242424] rounded-xl p-3">
                  <div>
                    <h4 className="font-medium">{item.name}</h4>
                    <p className="text-orange-500">₺{item.price} x {item.quantity} = ₺{item.price * item.quantity}</p>
                  </div>
                  <div className="flex items-center gap-2">
                    <button onClick={() => removeFromCart(item.id)} className="w-8 h-8 rounded-full bg-[#1a1a1a] flex items-center justify-center">
                      <Minus className="w-4 h-4" />
                    </button>
                    <span className="w-6 text-center">{item.quantity}</span>
                    <button onClick={() => addToCart({ id: item.id, name: item.name, price: item.price, description: '', category_id: '' })} className="w-8 h-8 rounded-full bg-orange-500 flex items-center justify-center">
                      <Plus className="w-4 h-4" />
                    </button>
                  </div>
                </div>
              ))}
              
              <input
                type="text"
                placeholder="İsminiz (opsiyonel)"
                value={customerName}
                onChange={(e) => setCustomerName(e.target.value)}
                className="w-full px-4 py-3 bg-[#242424] rounded-xl border border-white/5 outline-none mt-4"
              />
              <input
                type="text"
                placeholder="Sipariş notu (opsiyonel)"
                value={note}
                onChange={(e) => setNote(e.target.value)}
                className="w-full px-4 py-3 bg-[#242424] rounded-xl border border-white/5 outline-none"
              />
            </div>
            
            <div className="p-4 border-t border-white/5">
              <div className="flex justify-between mb-4">
                <span className="text-gray-400">Toplam</span>
                <span className="text-2xl font-bold">₺{cartTotal}</span>
              </div>
              <button
                onClick={handlePlaceOrder}
                disabled={ordering}
                className="w-full py-4 bg-orange-500 rounded-xl font-semibold flex items-center justify-center gap-2 disabled:opacity-50"
              >
                {ordering ? (
                  <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin" />
                ) : (
                  <>
                    <Send className="w-5 h-5" />
                    Siparişi Gönder
                  </>
                )}
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Rezervasyon Modal */}

      {/* Share Modal */}
      {showShareModal && venue && (
        <ShareModal
          venue={{ name: venue.name, district: venue.district, instagram: venue.instagram }}
          onClose={() => setShowShareModal(false)}
        />
      )}
      {showReservationModal && (
        <ReservationModal 
          venue={venue} 
          onClose={() => setShowReservationModal(false)} 
        />
      )}
    </div>
  )
}

// Rezervasyon Modal Bileşeni
function ReservationModal({ venue, onClose }: { venue: Venue; onClose: () => void }) {
  const { user, profile } = useAuth()
  const [date, setDate] = useState('')
  const [time, setTime] = useState('')
  const [guests, setGuests] = useState(2)
  const [name, setName] = useState(profile?.display_name || '')
  const [phone, setPhone] = useState('')
  const [notes, setNotes] = useState('')
  const [loading, setLoading] = useState(false)
  const [success, setSuccess] = useState(false)

  const handleSubmit = async () => {
    console.log("Values:", { date, time, name, phone })
    if (!date || !time || !name) {
      alert('Lütfen tüm zorunlu alanları doldurun')
      return
    }

    setLoading(true)

    const { error } = await supabase
      .from('reservations')
      .insert({
        venue_id: venue.id,
        customer_name: name,
        user_id: user?.id,
        reservation_date: date,
        reservation_time: time,
        party_size: guests,
        status: 'pending',
        notes: notes || null,
        
      })

    setLoading(false)

    if (error) {
      alert('Rezervasyon oluşturulamadı: ' + error.message)
    } else {
      setSuccess(true)
    }
  }

  if (success) {
    return (
      <div className="fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4">
        <div className="w-full max-w-sm bg-[#1a1a1a] rounded-2xl p-6 text-center">
          <div className="w-16 h-16 rounded-full bg-green-500/20 flex items-center justify-center mx-auto mb-4">
            <Calendar className="w-8 h-8 text-green-500" />
          </div>
          <h2 className="text-xl font-bold mb-2">Rezervasyon Alındı!</h2>
          <p className="text-gray-400 mb-4">{venue.name}</p>
          <p className="text-sm text-gray-300 mb-6">
            {date} • {time} • {guests} kişi
          </p>
          <p className="text-orange-400 text-sm mb-6">
            Rezervasyonunuz onay bekliyor. Size en kısa sürede dönüş yapılacak.
          </p>
          <button onClick={onClose} className="w-full py-3 bg-orange-500 rounded-xl font-semibold">
            Tamam
          </button>
        </div>
      </div>
    )
  }

  return (
    <div className="fixed inset-0 z-50 bg-black/80 flex items-end">
      <div className="w-full max-h-[90vh] bg-[#1a1a1a] rounded-t-3xl flex flex-col">
        <div className="flex items-center justify-between p-4 border-b border-white/5">
          <h2 className="text-xl font-bold">Rezervasyon Yap</h2>
          <button onClick={onClose} className="w-8 h-8 rounded-full bg-[#242424] flex items-center justify-center">
            <X className="w-5 h-5" />
          </button>
        </div>
        
        <div className="flex-1 overflow-auto p-4 space-y-4">
          <div className="text-center mb-4">
            <h3 className="font-semibold">{venue.name}</h3>
            <p className="text-gray-400 text-sm">{venue.district}, {venue.city}</p>
          </div>

          {/* Tarih */}
          <div>
            <label className="text-gray-400 text-sm mb-2 block">Tarih *</label>
            <input
              type="date"
              value={date}
              onChange={(e) => setDate(e.target.value)}
              min={new Date().toISOString().split('T')[0]}
              className="w-full px-4 py-3 bg-[#242424] rounded-xl border border-white/5 outline-none"
            />
          </div>

          {/* Saat */}
          <div>
            <label className="text-gray-400 text-sm mb-2 block">Saat *</label>
            <select
              value={time}
              onChange={(e) => setTime(e.target.value)}
              className="w-full px-4 py-3 bg-[#242424] rounded-xl border border-white/5 outline-none"
            >
              <option value="">Saat seçin</option>
              {['12:00', '12:30', '13:00', '13:30', '14:00', '18:00', '18:30', '19:00', '19:30', '20:00', '20:30', '21:00', '21:30', '22:00'].map(t => (
                <option key={t} value={t}>{t}</option>
              ))}
            </select>
          </div>

          {/* Kişi Sayısı */}
          <div>
            <label className="text-gray-400 text-sm mb-2 block">Kişi Sayısı</label>
            <div className="flex items-center justify-center gap-4">
              <button
                onClick={() => setGuests(Math.max(1, guests - 1))}
                className="w-10 h-10 rounded-full bg-[#242424] flex items-center justify-center"
              >
                <Minus className="w-5 h-5" />
              </button>
              <span className="text-2xl font-bold w-12 text-center">{guests}</span>
              <button
                onClick={() => setGuests(Math.min(20, guests + 1))}
                className="w-10 h-10 rounded-full bg-[#242424] flex items-center justify-center"
              >
                <Plus className="w-5 h-5" />
              </button>
            </div>
          </div>

          {/* İsim */}
          <div>
            <label className="text-gray-400 text-sm mb-2 block">İsim Soyisim *</label>
            <input
              type="text"
              value={name}
              onChange={(e) => setName(e.target.value)}
              placeholder="Adınız Soyadınız"
              className="w-full px-4 py-3 bg-[#242424] rounded-xl border border-white/5 outline-none"
            />
          </div>

          {/* Notlar */}
          <div>
            <label className="text-gray-400 text-sm mb-2 block">Özel İstekler (opsiyonel)</label>
            <textarea
              value={notes}
              onChange={(e) => setNotes(e.target.value)}
              placeholder="Doğum günü, pencere kenarı, bebek sandalyesi vs."
              rows={2}
              className="w-full px-4 py-3 bg-[#242424] rounded-xl border border-white/5 outline-none resize-none"
            />
          </div>
        </div>
        
        <div className="p-4 border-t border-white/5">
          <button
            onClick={handleSubmit}
            disabled={loading}
            className="w-full py-4 bg-orange-500 rounded-xl font-semibold flex items-center justify-center gap-2 disabled:opacity-50"
          >
            {loading ? (
              <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin" />
            ) : (
              <>
                <Calendar className="w-5 h-5" />
                Rezervasyon Yap
              </>
            )}
          </button>
        </div>
      </div>
    </div>
  )
}
